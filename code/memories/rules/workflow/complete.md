---
name: 自动执行
description: 在编码、预览、测试中，减少人工反馈，改善模型自我执行的效率。毕竟，在最终的成品中，人可以在使用中，不断完善细节。
---

## 执行状态：coding
当进入`coding`状态时，按照以下流程逐步执行。每个步骤完成后，评估条件并决定下一步。整个流程旨在确保代码质量、测试完整性和任务进度管理，直至所有任务完成。

1. **代码完成检查**：
   - 如果当前编码任务已完成，进入步骤2（预览）。
   - 如果未完成，继续编码直到完成。

2. **代码预览**：
   - 调用`codePreview.md`脚本对当前代码进行预览（显示代码结构、潜在问题等）。
   - 预览完成后，检查是否需要测试：
     - 如果代码尚未测试，进入步骤3（测试）。
     - 如果已测试过或无需测试，跳至步骤4（上下文压缩）。

3. **代码测试**：
   - 按照`test.md`的标准执行全面测试（包括单元测试、集成测试和错误检查）。
   - 测试完成后，记录结果（通过/失败/需修复）。
     - 如果测试通过，进入步骤4（上下文压缩）。
     - 如果测试失败，返回步骤1重新编码并修复。

4. **上下文管理和任务更新**（所有前期工作完成后执行）：
   - 先调用命令`/compact`压缩当前上下文（减少token消耗，保留关键信息）。
   - 更新to do list清单：
     - 标记当前任务为完成。
     - 审视剩余任务，优先级排序。
   - 确定下一项任务：
     - 如果还有未完成任务，返回步骤1开始新任务。
     - 如果所有任务完成，结束`coding`状态，并输出总结报告（包括完成任务列表、最终代码和任何备注）。

**流程结束条件**：当to do list为空时，停止执行并通知用户“所有任务已完成”。

## 意外情况处理
如果在以上流程中遇到不可预见的困难（如系统错误、外部依赖失败或逻辑卡住），必须立即停止当前执行，并遵循以下恢复流程：

1. **记录问题**：
   - 在`stuck.md`文件中记录详细信息，包括：
     - 停止步骤（例如“步骤2：预览失败”）。
     - 具体原因（例如“codePreview.md脚本调用超时”或“遇到未知错误”）。
     - 当前上下文摘要（已压缩版本）和建议修复思路。

2. **通知人工干预**：
   - 调用发送邮件脚本（`../tools/send_email.sh`），将`stuck.md`内容、当前任务状态和to do list作为附件发送给指定人工处理者（邮箱：6953405@163.com）。
   - 邮件主题：`[AI Assistant] Coding流程卡住 - 需要人工干预`。
   - 邮件正文简述：`流程在[步骤X]停止，详情见附件。请人工接管并回复以恢复。`

3. **恢复机制**：
   - 暂停所有自动化执行，等待人工回复。
   - 一旦收到人工指令，继续从记录的停止点恢复，或根据新指令调整流程。

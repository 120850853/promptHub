# 调试工作流程文档

## 一、日志记录目的和禁止内容

### 日志记录目的
- 监控数据变化是否符合预期
- 辅助调试和问题定位
- 追踪函数执行过程

### 禁止记录的内容
- 敏感信息：密码、完整信用卡号、隐私数据
- 个人身份信息（PII）
- 机密业务数据

## 二、调试工作流程

### 1. 测试驱动开发 (TDD)
```
测试用例编写 → 执行测试 → 比较结果 → 修复代码 → 重新测试
```


# 调试的基本原则

#### 测试用例规范
- 创建`test`目录存放所有测试用例
- 针对核心功能模块编写独立测试
- 覆盖正常、异常及边界情况
- 明确输入参数和期望输出

#### 测试执行步骤
1. 编写测试用例，明确函数输入参数和期望输出
2. 运行函数，获得实际输出结果
3. 比较预期输出与实际输出
4. 如果完全相同，则函数完成目标
5. 如果不同，则需要修改函数

### 2. 日志辅助调试
- 当预期输出与实际输出不一致时启用
- 在关键代码路径添加结构化日志
- 记录函数参数、返回值和内部变量
- 每个执行过程都需要输出结果
- 如果函数体中引用了**非传参数的变量**，也需要输出，避免全局变量的影响

### 3. 模块化与最小化变更
- 精确定位问题模块
- 只修改与Bug直接相关的代码
- 避免影响其他模块
- 修改后需解释修改的原因和目的

## 三、结构化日志格式规范

### 标准日志格式
```json
{
    "timestamp": "YYYY-MM-DDTHH:mm:ssZ",
    "level": "INFO", 
    "function": "functionName",
    "message": "Descriptive log message",
    "context": {
        "args": [],
        "return": "",
        "otherInfo": ""
    }
}
```

### 日志级别说明
- **INFO**: 一般信息
- **DEBUG**: 调试信息
- **WARN**: 警告信息
- **ERROR**: 错误信息

## 四、完整调试工作流程

### 步骤1：问题发现
- 通过测试用例发现预期输出与实际输出不一致
- 或通过运行时异常发现问题

### 步骤2：日志增强
- 在函数入口记录输入参数
- 在关键执行步骤记录中间状态
- 在函数出口记录返回值
- 对于引用的全局变量，额外记录其值

### 步骤3：日志分析
- 收集结构化日志数据
- 按时间顺序分析执行流程
- 定位异常或不符合预期的数据变化

### 步骤4：问题修复
- 根据日志分析定位根本原因
- 实施最小化代码修改
- 重新运行测试验证修复效果

### 步骤5：日志清理
- 问题修复后移除调试日志
- 保留必要的监控日志
- 确保不包含敏感信息

## 五、工作流程总结

这个调试工作流程包含了完整的闭环管理：

1. **预防性措施**：通过TDD确保代码质量
2. **问题定位**：使用结构化日志快速找到问题
3. **精确修复**：最小化变更避免引入新问题
4. **验证确认**：通过测试确保修复有效

### 关键要点
- 始终遵循结构化日志格式
- 严格禁止记录敏感信息
- 保持模块化思维，避免过度修改
- 测试用例要覆盖各种边界情况
- 记录每个过程的执行结果
- 关注全局变量对函数的影响